## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš” 
WhisperTextAnalyzerëŠ” ì‹¤ì‹œê°„ ìŒì„± ìŠ¤íŠ¸ë¦¼ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ê³  ê°ì • ë¶„ì„ì„ ìˆ˜í–‰í•˜ëŠ” End-to-End íŒŒì´í”„ë¼ì¸ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

- í´ë¼ì´ì–¸íŠ¸ ë¸Œë¼ìš°ì €ì—ì„œ **Web Audio API (ScriptProcessorNode)**ë¡œ ë§ˆì´í¬ ì…ë ¥ì„ ìº¡ì²˜í•˜ì—¬ FastAPI ì„œë²„ë¡œ ì „ì†¡
- **FastAPI WebSocket ì„œë²„**ê°€ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ìˆ˜ì‹  í›„ Redis audio_queueì— ì €ì¥
- **stt_worker (Celery Worker)**ê°€ audio_queue ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ **OpenAI Whisper ëª¨ë¸**ë¡œ STT (Speech-to-Text) ë³€í™˜
- í…ìŠ¤íŠ¸ë¥¼ Redis text_queueë¡œ ì „ë‹¬
- **analyzer_worker (Celery Worker)**ê°€ text_queueì˜ í…ìŠ¤íŠ¸ë¥¼ **transformers ê¸°ë°˜ ê°ì • ë¶„ì„ ëª¨ë¸**(`distilbert-base-uncased-finetuned-sst-2-english`)ë¡œ ë¶„ì„
- ë¶„ì„ ê²°ê³¼ëŠ” Redis PubSubì˜ result_channelë¡œ publish
- **listener ì„œë¹„ìŠ¤**ê°€ result_channelì„ êµ¬ë…í•˜ì—¬ ê²°ê³¼ ë° í†µê³„ ì •ë³´ë¥¼ íŒŒì¼(`result_listener.log`) + ì½˜ì†”ì— ì¶œë ¥
- ìµœì¢…ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” Web UIì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ìì‹ ì˜ ìŒì„± í…ìŠ¤íŠ¸ + ê°ì • ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸ ê°€ëŠ¥


## ğŸ› ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
````
Client (ë¸Œë¼ìš°ì €: Web Audio â†’ WebSocket)
â†“
FastAPI ì„œë¹„ìŠ¤ (audio_queueë¡œ Redis push)
â†“
Redis (audio_queue â†’ text_queue â†’ PubSub result_channel)
â†“
stt_worker (Celery + Whisper ëª¨ë¸ â†’ text_queueë¡œ push)
â†“
analyzer_worker (Celery + transformers ê°ì • ë¶„ì„ â†’ result_channelë¡œ publish)
â†“
listener (result_channel êµ¬ë… â†’ ì½˜ì†” + íŒŒì¼ë¡œ ì¶œë ¥)
````



---

## âš™ï¸ ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ
- FastAPI + WebSocket
- Web Audio API (ScriptProcessorNode ê¸°ë°˜)
- Redis (Queue + Pub/Sub)
- Celery (ë¹„ë™ê¸° Worker ê´€ë¦¬)
- Whisper (STT ëª¨ë¸, OpenAI Whisper ê¸°ë°˜)
- Huggingface Transformers (`distilbert-base-uncased-finetuned-sst-2-english` ê°ì • ë¶„ì„)
- Docker + Docker Compose

---

## ğŸ§© ê°œë°œ ì¤‘ ê²ªì—ˆë˜ ë¬¸ì œ ë° í•´ê²° ë°©ë²•

### 1. Python whisper vs openai-whisper í˜¼ìš© ë¬¸ì œ
- ì´ˆê¸°ì—ëŠ” **íŒ¨í‚¤ì§€ whisper**ì™€ **ëª¨ë“ˆ whisper(openai-whisper)**ê°€ í˜¼ìš©ë˜ì–´ ì¶©ëŒ ë°œìƒ
- íŠ¹íˆ **Celery workerì˜ -A ì¸ìì—ì„œ worker íŒŒì¼ëª…ê³¼ whisper íŒ¨í‚¤ì§€ëª…ì´ ì¶©ëŒ** â†’ Celery app load ì‹¤íŒ¨
- **í•µì‹¬ í•´ê²°**
  - worker íŒŒì¼ëª…ì„ `stt_worker.py`, `analyzer_worker.py` ë“±ìœ¼ë¡œ ëª…í™•í•˜ê²Œ ì„¤ì • (ì ˆëŒ€ whisper.py ì“°ì§€ ì•ŠìŒ)
  - Celery ì‹¤í–‰ ì‹œ `celery -A stt_worker:celery_app worker --concurrency=1 --pool=solo`ë¡œ ì •í™•í•˜ê²Œ ëª¨ë“ˆ ì§€ì •
- **ì¶”ê°€ ì•ˆì „ì±…**
  - ì½”ë“œì—ì„œ import í˜¼ë™ ë°©ì§€ë¥¼ ìœ„í•´ `import whisper as openai_whisper`ë¡œ í†µì¼

### 2. Windows í™˜ê²½ ê°œë°œ ì‹œ ì œí•œ ì‚¬í•­

- Windows + Docker í™˜ê²½ì—ì„œ **Celery worker ì»¨í…Œì´ë„ˆ ë¹„ì •ìƒ ì¢…ë£Œ, crash** ë°œìƒ
- ì›ì¸: **WindowsëŠ” fork() ë¯¸ì§€ì› â†’ spawn() ë°©ì‹ìœ¼ë¡œ ë¶ˆì•ˆì •**
- ë©€í‹° concurrency ì„¤ì • ì‹œ ë¬¸ì œ ì‹¬í™” â†’ ë°˜ë“œì‹œ `--pool=solo` ì„¤ì • í•„ìš”  
  â†’ `--pool=solo`: **ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤, ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œë§Œ ì‹¤í–‰í•˜ë„ë¡ ê°•ì œ** (Windows í™˜ê²½ì—ì„œ ì•ˆì •ì„± í™•ë³´)
- Dockerì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **í˜¸ìŠ¤íŠ¸ ë§ˆì´í¬ ì‚¬ìš© ë¶ˆê°€**
- í•´ê²°:
  - `record` ì„œë¹„ìŠ¤ë§Œ ë¡œì»¬ Python í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰
  - ë‚˜ë¨¸ì§€ ì„œë¹„ìŠ¤(`fastapi_service`, `stt_worker`, `redis`)ëŠ” Dockerë¡œ ìš´ì˜
  - ë˜ëŠ” Redisë§Œ Docker, ë‚˜ë¨¸ì§€ëŠ” ë¡œì»¬ë¡œ ì¡°í•© í…ŒìŠ¤íŠ¸

#### âœ… Windows vs Linux â†’ Celery ë©€í‹° í”„ë¡œì„¸ìŠ¤ ì°¨ì´

| ì‹œìŠ¤í…œ | fork() ì§€ì› | Celery ë©€í‹°í”„ë¡œì„¸ìŠ¤ | ê²°ê³¼ |
|-------|-------------|---------------------|------|
| Linux, macOS | âœ… ì§€ì› (`fork()`) | ì •ìƒ ì‘ë™ | ë¬¸ì œ ì—†ìŒ |
| Windows | âŒ ë¯¸ì§€ì› â†’ `spawn()` | ë¶ˆì•ˆì • | worker crash, hang |

#### âœ… fork() vs spawn() ìš”ì•½

| ë°©ì‹ | íŠ¹ì§• | ë¹„ìœ  |
|------|------|------|
| **fork()** | ë¶€ëª¨ ë©”ëª¨ë¦¬ë¥¼ ê·¸ëŒ€ë¡œ ë³µì œ â†’ ë¹ ë¥´ê³  ì•ˆì •ì  | ë³µì‚¬ê¸°ë¡œ ì¦‰ì‹œ ë³µì‚¬ |
| **spawn()** | ìƒˆ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹œì‘ â†’ RAM, CPU ì¶”ê°€ ì†Œëª¨ | ìƒˆ ì»´í“¨í„°ì— í”„ë¡œê·¸ë¨ ì¬ì„¤ì¹˜ |

#### âœ… Windowsì—ì„œ spawn()ì˜ ë¬¸ì œ

- `spawn()`ì€ ìƒˆë¡œ Python interpreter + ëª¨ë“  ëª¨ë“ˆ + celery contextë¥¼ ë‹¤ì‹œ ë¡œë“œ â†’ **RAM, CPU ì‚¬ìš©ëŸ‰ ì¦ê°€**
- Docker + Celery + Windows ì¡°í•©ì—ì„œ child processë“¤ì´ redis, broker ì—°ê²° ì‹¤íŒ¨ â†’ **ì£½ìŒ, hang, crash**
- ì‹¤ì§ˆì ìœ¼ë¡œ **Windowsì—ì„œëŠ” Celery ë©€í‹° í”„ë¡œì„¸ìŠ¤ ì‚¬ìš© ë¶ˆê°€**

### 3. ë¦¬ëˆ…ìŠ¤ ì„œë²„ (Azure Linux VM) ë°°í¬ ì‹œ ì–´ë ¤ì›€
- ë¦¬ëˆ…ìŠ¤ëŠ” ìœˆë„ìš°ì™€ ë‹¬ë¼ ê²½ë¡œ, íŒŒì¼ ê¶Œí•œ ë“±ì—ì„œ ì°¨ì´ê°€ ì¡´ì¬
- ì˜ˆìƒì¹˜ ëª»í•œ permission ë¬¸ì œ, Redis ì ‘ì† ë¬¸ì œ ë°œìƒ
- **í•´ê²°**: Azure VM í™˜ê²½ ë§ì¶° Docker ì¬ì…‹íŒ…í•˜ê³  FastAPI ì„œë²„, Redis ì„œë²„ ë”°ë¡œ íŠœë‹

### 4. STT ì„œë¹„ìŠ¤ì˜ ìƒ˜í”Œë§ ì£¼íŒŒìˆ˜ ë¬¸ì œ (ì‹¤ì‹œê°„ FastAPI ì†Œì¼“ í†µì‹ )

- Whisper ëª¨ë¸(STT)ì€ **16,000Hz (16kHz)** ìƒ˜í”Œë§ì„ ìš”êµ¬
- í•˜ì§€ë§Œ ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼, ë””ë°”ì´ìŠ¤ ë§ˆì´í¬ì˜ ê¸°ë³¸ ìƒ˜í”Œë§ì€ ë³´í†µ **44,100Hz, 48,000Hz** ë“±ìœ¼ë¡œ ë‹¤ì–‘í•˜ì—¬ **ìƒ˜í”Œë§ ë¶ˆì¼ì¹˜ ë¬¸ì œê°€ ë°œìƒ**
- FastAPI WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ ì—°ê²° ì‹œ **ì„œë²„ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ downsampling (ìƒ˜í”Œë ˆì´íŠ¸ ë³€í™˜)**ì´ í•„ìš”
- **ë³€í™˜ ê³¼ì •ì˜ ì£¼ìš” ë¬¸ì œì **
  - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ëŠ” ì—°ì† ë²„í¼ë¡œ ë“¤ì–´ì™€ **ì‹¤ì‹œê°„ downsampleì´ ê¹Œë‹¤ë¡œì›€**
  - Python `sounddevice`, `scipy.signal.resample_poly()` ë“±ì„ í†µí•´ ë³€í™˜ ë¡œì§ì„ ì§ì ‘ êµ¬í˜„
  - ë°ì´í„° ì§€ì—°(Latency)ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ **ìµœì ì˜ ë²„í¼ í¬ê¸°**ì™€ **ë³€í™˜ ì†ë„**ë¥¼ ì§€ì†ì ìœ¼ë¡œ íŠœë‹
- **ìµœì¢… í•´ê²° ë°©ë²•**
  - í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ ì „ë‹¬ ì§í›„ `resample_poly()`ë¡œ **44.1kHz â†’ 16kHz** ë³€í™˜
  - STT ëª¨ë¸ë¡œ ì „ë‹¬ ì „ í•­ìƒ **16kHzë¡œ í‘œì¤€í™”**
  - í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ìµœì  ë²„í¼ í¬ê¸°ì™€ ì²˜ë¦¬ ì£¼ê¸°ë¥¼ ì¡°ì •í•˜ì—¬ **ì‹¤ì‹œê°„ì„± + ì•ˆì •ì„± ëª¨ë‘ í™•ë³´*

### 5. HTTPS ì¸ì¦ ê´€ë ¨ ì´ìŠˆ (ë¸Œë¼ìš°ì € ë§ˆì´í¬ ê¶Œí•œ)
- ì‹¤ì„œë²„ ë°°í¬ ì‹œ HTTPSê°€ ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì €ê°€ ë§ˆì´í¬ ì ‘ê·¼ ì°¨ë‹¨
- Let's Encryptë¡œ ë¬´ë£Œ SSL ë°œê¸‰ ì‹œë„í–ˆì§€ë§Œ, ê´€ë¦¬ ë³µì¡ + ì‹œê°„ ë¬¸ì œ

### 6. ngrokìœ¼ë¡œ ìš°íšŒ í…ŒìŠ¤íŠ¸
- ê°„ë‹¨íˆ `ngrok http 8000`ì„ ì‚¬ìš©í•´ HTTPS ìš°íšŒ
- **ë‹¨ì **: ngrok ë¬´ë£Œ ë²„ì „ì€ 1ì‹œê°„ë§ˆë‹¤ ì£¼ì†Œê°€ ë°”ë€œ
- **ì¥ì **: ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸, ëª¨ë°”ì¼ ì ‘ì†, ë‹¤ë¥¸ PC ì ‘ì† ë“± ì‰½ê²Œ í•´ê²° ê°€ëŠ¥

---

## ğŸ–¼ï¸ ìµœì¢… í”„ë¡œì íŠ¸ ë°°í¬ êµ¬ì¡°
> ê°œë°œ ì¤‘ `record_service`ëŠ” í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì‚¬ìš©í–ˆìœ¼ë‚˜, ìµœì¢… ë°°í¬ì—ì„œëŠ” ì œì™¸

````
WhisperTextAnalyzer/
â”œâ”€â”€ analyzer_worker/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ worker.py
â”œâ”€â”€ fastapi_service/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ service.py
â”œâ”€â”€ listener_service/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ service.py
â”œâ”€â”€ stt_worker/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ worker.py
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .gitignore
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ README.md
â””â”€â”€ requirements.txt
````


## âœ¨ ìµœì¢… ì†Œê°
- **Python í™˜ê²½ (Windows vs Linux)** ì°¨ì´ë¥¼ ì§ì ‘ ê²½í—˜í•˜ë©° ë°°ì› ìŒ
- ì‹¤ì‹œê°„ WebSocket ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ì˜ ì–´ë ¤ì›€ì„ ì²´í—˜
- Whisper ëª¨ë¸ì´ ê¸°ëŒ€í•˜ëŠ” ì˜¤ë””ì˜¤ í¬ë§·(WAV, 16kHz, mono)ì„ ë§ì¶”ëŠ” ê²Œ ì–¼ë§ˆë‚˜ ê¹Œë‹¤ë¡œìš´ì§€ ì´í•´
- ì‹¤ì„œë¹„ìŠ¤ ë°°í¬ê¹Œì§€ ì§ì ‘ ë‹¤ë£¨ë©´ì„œ **Docker, Redis, Celery, Web Audio API** ì „ì²´ ìŠ¤íƒ ê²½í—˜ ì™„ë£Œ
- ngrokì„ í†µí•œ ê°„í¸ í…ŒìŠ¤íŠ¸ ê¸°ë²•ì„ ì‹¤ë¬´ì—ì„œ ìµí˜

---

# ğŸ“¢ ì£¼ì˜ì‚¬í•­
- ë³¸ í”„ë¡œì íŠ¸ëŠ” í•™ìŠµ ë° ë°ëª¨ìš©ì´ë©°, ì‹¤ì œ ìƒìš© ì„œë¹„ìŠ¤ ë°°í¬ ì‹œ HTTPS/ì¸ì¦/ë³´ì•ˆ ì„¤ì •ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.
