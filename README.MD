<p>
  <img src="https://img.shields.io/badge/Python-3.10-blue?logo=python&logoColor=white"/>
  <img src="https://img.shields.io/badge/FastAPI-API-009688?logo=fastapi&logoColor=white"/>
  <img src="https://img.shields.io/badge/Redis-Broker-DC382D?logo=redis&logoColor=white"/>
  <img src="https://img.shields.io/badge/Celery-Task%20Queue-37814A?logo=celery&logoColor=white"/>
  <img src="https://img.shields.io/badge/OpenAI-Whisper-3D3D3D?logo=openai&logoColor=white"/>
  <img src="https://img.shields.io/badge/HuggingFace-Transformers-FFD21F?logo=huggingface&logoColor=black"/>
  <img src="https://img.shields.io/badge/sounddevice-Audio-blueviolet"/>
  <img src="https://img.shields.io/badge/Docker-Container-2496ED?logo=docker&logoColor=white"/>
  <img src="https://img.shields.io/badge/Azure-Cloud%20Server-0078D4?logo=microsoftazure&logoColor=white"/>
  <img src="https://img.shields.io/badge/Linux-Server-FCC624?logo=linux&logoColor=black"/>
  <img src="https://img.shields.io/badge/Nginx-Reverse%20Proxy-009639?logo=nginx&logoColor=white"/>
  <img src="https://img.shields.io/badge/NVIDIA-RTX%203070-76B900?logo=nvidia&logoColor=white"/>
  <img src="https://img.shields.io/badge/Windows-10%2B-0078D6?logo=windows&logoColor=white"/>
  <img src="https://img.shields.io/badge/ChatGPT-Assistant-10a37f?logo=openai&logoColor=white"/>
  <img src="https://img.shields.io/badge/PyCharm-Professional-000000?logo=jetbrains&logoColor=white"/>
  <img src="https://img.shields.io/badge/Git-Version%20Control-F05032?logo=git&logoColor=white"/>
</p>

# ğŸ§ WhisperTextAnalyzer

> **ì‹¤ì‹œê°„ ìŒì„± ìŠ¤íŠ¸ë¦¬ë° â†’ STT â†’ ê°ì • ë¶„ì„ê¹Œì§€**  
> End-to-End íŒŒì´í”„ë¼ì¸ì„ êµ¬í˜„í•œ ì›¹ ê¸°ë°˜ ìŒì„± ì¸ì‹ ì‹œìŠ¤í…œ

---
ğŸ¯ ë³¸ í”„ë¡œì íŠ¸ëŠ” ì‹¤ë¬´ì— ê°€ê¹Œìš´ **MSA + ë¹„ë™ê¸° Task Queue êµ¬ì¡°**ë¥¼ ì§ì ‘ ì„¤ê³„í•˜ê³  **Docker ê¸°ë°˜ìœ¼ë¡œ ë°°í¬**í•œ ì˜ˆì œì…ë‹ˆë‹¤.  
- ğŸ™ï¸ **ë¸Œë¼ìš°ì € AudioWorklet â†’ FastAPI WebSocket â†’ Redis/Celery Task Queue â†’ STT/ê°ì • ë¶„ì„**  
- ì‹¤ì œ ì„œë¹„ìŠ¤ íë¦„ì„ ìœ ì‚¬í•˜ê²Œ êµ¬ì„±í•˜ì—¬, **ì‹¤ì‹œê°„ ìŒì„± â†’ í…ìŠ¤íŠ¸ â†’ ê°ì • ë¶„ì„**ê¹Œì§€ ìë™ ì²˜ë¦¬í•˜ë©°  
- **Azure Linux ì„œë²„ + nginx + DuckDNS + HTTPS ì¸ì¦ì„œ**ê¹Œì§€ í¬í•¨í•œ **ì‹¤ì œ ë°°í¬ ê²½í—˜**ê¹Œì§€ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
---
## ğŸ“¸ WhisperTextAnalyzer ì‹œìŠ¤í…œ ì‹¤í–‰ ì˜ˆì‹œ

<p>
  <img src="img.jpg" alt="WhisperTextAnalyzer ì‹œìŠ¤í…œ ì‹¤í–‰ ì˜ˆì‹œ" width="50%"/>
</p>

## ğŸ‰ ìµœì¢… ì†Œê°

---
- Python + FastAPI + Redis + Celery ê¸°ë°˜ì˜ STT ë° ê°ì • ë¶„ì„ íŒŒì´í”„ë¼ì¸ì„ ì§ì ‘ ì„¤ê³„í•˜ê³ , **ê°œë°œë¶€í„° Docker ë°°í¬ê¹Œì§€ ì „ ê³¼ì •ì„ í˜¼ì êµ¬í˜„**
- Celery(ë¹„ë™ê¸° Task Queue)ì™€ Redis(Queue ë° Pub/Sub ë©”ì‹œì§€ ë¸Œë¡œì»¤)ë¥¼ í™œìš©í•˜ì—¬ MSA(Microservice Architecture) ìŠ¤íƒ€ì¼ì˜ êµ¬ì¡°ë¥¼ êµ¬ì„±í•˜ê³ , ì‹¤ë¬´ì— ê°€ê¹Œìš´ ì²˜ë¦¬ íë¦„ê³¼ ë™ì‘ ì›ë¦¬ë¥¼ ì²´ê³„ì ìœ¼ë¡œ í•™ìŠµ
- Dockerë¥¼ ê¸°ë°˜ìœ¼ë¡œ Windows/Linux ê°„ í™˜ê²½ ì°¨ì´, ì´ë¯¸ì§€ ìµœì í™”, ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  êµ¬ì„± ë“± ì‹¤ë¬´ì™€ ìœ ì‚¬í•œ ì¸í”„ë¼ êµ¬ì¶• ê²½í—˜
- ì‹¤ì œ ì„œë¹„ìŠ¤ êµ¬ì¡°ë¥¼ ê³ ë ¤í•´ ëª¨ë“ˆ ê°„ ì—­í•  ë¶„ë¦¬, ë¹„ë™ê¸° ë³‘ë ¬ ì²˜ë¦¬, ë©”ì‹œì§€ í íë¦„ ë“±ì„ í¬í•¨í•œ MSA ìœ ì‚¬ ì•„í‚¤í…ì²˜ë¥¼ êµ¬í˜„
- WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ í†µì‹ ê³¼ Web Audio APIì˜ AudioWorkletì„ í™œìš©í•´, ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤ì‹œê°„ ë§ˆì´í¬ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì„ ìˆ˜ì§‘í•˜ê³  Whisper ëª¨ë¸ê³¼ ì—°ë™
- AudioWorklet ë‚´ì— VAD(Vocal Activity Detection) í•„í„°ë¥¼ ì ìš©í•˜ì—¬ ë¬´ìŒ êµ¬ê°„ì„ ì œê±°í•¨ìœ¼ë¡œì¨, ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ì™€ STT ë¹„ìš©ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì ˆê°
---
## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”
- ë¸Œë¼ìš°ì €(Web Audio API + AudioWorklet)ì—ì„œ ë§ˆì´í¬ ì…ë ¥ì„ ìº¡ì²˜í•˜ì—¬ FastAPI ì„œë²„ë¡œ ì „ì†¡
- FastAPI WebSocket ì„œë²„ê°€ ìˆ˜ì‹ í•œ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ STT ì‘ì—…ìš© Celery Task(transcribe_audio)ë¡œ ë¹„ë™ê¸° í˜¸ì¶œ â†’ stt_queue ë“±ë¡
- stt_workerê°€ OpenAI Whisperë¡œ ìŒì„± ì¸ì‹(STT) ìˆ˜í–‰ í›„, Celery Task(analyze_text)ë¥¼ ë¹„ë™ê¸° í˜¸ì¶œ â†’ analyzer_queue ë“±ë¡
- analyzer_workerê°€ Huggingface Transformersë¡œ ê°ì • ë¶„ì„ ìˆ˜í–‰ í›„ Redisì˜ result_channelì— ê²°ê³¼ ë©”ì‹œì§€ ë°œí–‰
- listener_serviceê°€ result_channelì„ êµ¬ë…í•˜ì—¬ ê²°ê³¼ ë° í†µê³„ë¥¼ ì²˜ë¦¬í•œ ë’¤, result_messages / final_stats ì±„ë„ë¡œ ê°ê° ë°œí–‰
- FastAPIê°€ ë‘ ì±„ë„ì„ êµ¬ë…í•˜ì—¬, WebSocketì„ í†µí•´ ë¸Œë¼ìš°ì €ì— ì‹¤ì‹œê°„ ê²°ê³¼ì™€ í†µê³„ë¥¼ ì—…ë°ì´íŠ¸
---

## ğŸ› ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
Browser (AudioWorklet: ë§ˆì´í¬ ì…ë ¥ + 16kHz PCM ë³€í™˜)
        â†“
    WebSocket ì „ì†¡
        â†“
FastAPI ì„œë²„
        â†“
Celery Task (transcribe_audio) í˜¸ì¶œ â†’ stt_queue ë“±ë¡
        â†“
stt_worker (OpenAI Whisperë¡œ STT ìˆ˜í–‰)
        â†“
Celery Task (analyze_text) í˜¸ì¶œ â†’ analyzer_queue ë“±ë¡
        â†“
analyzer_worker (Huggingface Transformersë¡œ ê°ì • ë¶„ì„)
        â†“
Redis Pub/Sub (result_channelë¡œ ê²°ê³¼ ë°œí–‰)
        â†“
listener_service (result_channel êµ¬ë… â†’ í†µê³„ ì²˜ë¦¬ â†’ result_messages, final_stats ë°œí–‰)
        â†“
FastAPI (2ê°œ ì±„ë„ êµ¬ë…)
        â†“
    WebSocket ì „ì†¡
        â†“
Browser ì‹¤ì‹œê°„ ê²°ê³¼ í‘œì‹œ
```

ì°¸ê³ : ê°œë°œ ì¤‘ recorder_serviceë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸ (ë°°í¬ì—ëŠ” ë¯¸í¬í•¨)

---

### ğŸ“‹ ì£¼ìš” ì»¨í…Œì´ë„ˆ

- redis : Broker ì—­í• 
- stt_worker : ìŒì„± ì¸ì‹ STT ì²˜ë¦¬ (Celery) OpenAIê°€ ê°œë°œí•œ WhisperëŠ”16kHz mono PCM ìŒì„±ì„ ë°›ì•„ í…ìŠ¤íŠ¸ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
- analyzer_worker : ê°ì • ë¶„ì„ ì²˜ë¦¬ (Celery)
- listener_service : ê²°ê³¼ ë° í†µê³„ ì¶œë ¥
- fastapi_service : WebSocket ì„œë²„ + í´ë¼ì´ì–¸íŠ¸ UI
---
## âœ… ê¸°ìˆ  ê°œì„  ìš”ì•½ ë° êµ¬ì¡° ì•ˆì •í™” í˜„í™©

| ê°œì„  í•­ëª©                                             | ìƒíƒœ |
|---------------------------------------------------|------|
| Whisper ëª¨ë¸ STT íŒŒì´í”„ë¼ì¸                              | âœ… ì™„ì„± |
| Sentiment ë¶„ì„ ëª¨ë“ˆ                                   | âœ… ì™„ì„± |
| Listener í†µê³„ ì²˜ë¦¬                                    | âœ… ê°œì„  ì™„ë£Œ |
| FastAPI WebSocket ì„œë²„                              | âœ… ê°œì„  ì™„ë£Œ |
| ì‹¤ì‹œê°„ AudioWorklet + VAD í•„í„°ë§                        | âœ… ì ìš© ì™„ë£Œ |
| Multi User Buffer êµ¬ì¡°                              | âœ… ì ìš© ì™„ë£Œ |
| Silence Threshold ê°œì„                               | âœ… ì ìš© ì™„ë£Œ |
| Whisper ì…ë ¥ í¬ë§·(PCM â†’ WAV ë³€í™˜)                         | âœ… êµ¬í˜„ ì™„ë£Œ |
| WebSocket Binary ì•ˆì • ìˆ˜ì‹  ì²˜ë¦¬                         | âœ… ì ìš© ì™„ë£Œ |
| Celery ì»¨í…Œì´ë„ˆ ê°„ ë…ë¦½ì„± í™•ë³´                              | âœ… ì ìš© ì™„ë£Œ |
| Redis Pub/Sub ë‹¤ì±„ë„ êµ¬ì¡° ì„¤ê³„                           | âœ… ì„¤ê³„ ë°˜ì˜ |
| HTTPS/ë„ë©”ì¸ ìš°íšŒ í…ŒìŠ¤íŠ¸(ngrok)                           | âœ… ì‹¤ìŠµ ì™„ë£Œ |
| Azure VM + DuckDNS + SSL ì¸ì¦ì„œ + nginx + Docker ì‹¤ì„œë²„ ìš´ì˜| âœ… ì‹¤ë°°í¬ ì™„ë£Œ |
---
## ğŸ§© ì£¼ìš” ë¬¸ì œ ë° ê°œì„ , í•™ìŠµ ë‚´ì—­ 1ï¸âƒ£6ï¸âƒ£ê°œ

### 1ï¸âƒ£ whisper íŒ¨í‚¤ì§€ ì¶©ëŒ â†’ openai-whisper ëª…í™•íˆ ì‚¬ìš©

```python
import whisper as openai_whisper
```

### 2ï¸âƒ£ Windows Docker + Celery crash â†’ pool=soloë¡œ í•´ê²°

```bash
celery -A stt_worker:celery worker -Q stt_queue --loglevel=info --concurrency=1 --pool=solo
```

### 3ï¸âƒ£ ë¸Œë¼ìš°ì € ìƒ˜í”Œë§ mismatch â†’ AudioWorklet + 16kHz ê³ ì • ê°œì„ 

- AudioContext({ sampleRate: 16000 })
- AudioWorklet â†’ FastAPIë¡œ ì‹¤ì‹œê°„ binary stream ì „ì†¡

### 4ï¸âƒ£ HTTPS í•„ìˆ˜ ì´ìŠˆ â†’ ngrokìœ¼ë¡œ ì„ì‹œ ìš°íšŒ (ê°œë°œ í…ŒìŠ¤íŠ¸)

```bash
ngrok http 8000
```

### 5ï¸âƒ£ FastAPI WebSocket â†’ receive_bytes()ë¡œ ë³€ê²½í•˜ì—¬ binary ì•ˆì • ìˆ˜ì‹ 

```python
await websocket.receive_bytes()
```

### 6ï¸âƒ£ Celery send_task()ë¡œ ì»¨í…Œì´ë„ˆ ê°„ ë…ë¦½ì„± í™•ë³´

```python
celery.send_task("stt_worker.transcribe_audio", args=[audio_chunk], queue="stt_queue")
```

### 7ï¸âƒ£ Redis default queue ë°©ì§€ â†’ queue ëª…ì‹œ

```bash
celery -A analyzer_worker:celery worker -Q analyzer_queue --loglevel=info
```

### 8ï¸âƒ£ connectionë³„ buffer êµ¬ì¡°ë¡œ ë‹¤ì¤‘ ì‚¬ìš©ì ì•ˆì •ì„± í™•ë³´

```python
connected_users[websocket] = {"buffer": bytearray(), "start_time": None}
```

### 9ï¸âƒ£ Silence Threshold ê°œì„  â†’ ì—ë„ˆì§€ ê¸°ì¤€ì„ 0.0005ë¡œ ì¡°ì •í•˜ì—¬ ìŒì„± ì¸ì‹ ë¯¼ê°ë„ ê°œì„ 

```javascript
if (energy < 0.0005) return true;
```

### 1ï¸âƒ£0ï¸âƒ£ FastAPI ì„œë²„ ì‹œì‘ ì‹œ Redis Subscriber ë¹„ë™ê¸° ë“±ë¡ êµ¬ì¡°ë¡œ ê°œì„ 

```python
@app.on_event("startup")
async def startup_event():
    asyncio.create_task(redis_subscriber())
```
### 1ï¸âƒ£1ï¸âƒ£ WebSocket í†µì‹  êµ¬ì¡° í•™ìŠµ â†’ ì—°ê²° ìœ ì§€ ë°©ì‹ ë° WebSocket íŠ¹ì„± í•™ìŠµ  

WebSocketì€ HTTPì™€ ë‹¬ë¦¬ ì§€ì†ì ì¸ ì–‘ë°©í–¥ ì—°ê²°ì„ ìœ ì§€í•˜ë©°,  
FastAPI ë‚´ë¶€ì—ì„œ .send_text() ë˜ëŠ” .send_bytes()ë¥¼ í†µí•´ ì‹¤ì‹œê°„ í‘¸ì‹œê°€ ê°€ëŠ¥í•¨.  
í´ë¼ì´ì–¸íŠ¸ê°€ ëª…ì‹œì ìœ¼ë¡œ ì—°ê²°ì„ ë‹«ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì´ìƒ ì—°ê²°ì€ ê³„ì† ìœ ì§€ë¨.  
â†’ ì˜¤ë””ì˜¤ ë²„í¼ë¥¼ 1ì´ˆë§ˆë‹¤ ì „ì†¡í•´ë„ ì—°ê²°ì„ ìƒˆë¡œ ì—¬ëŠ” êµ¬ì¡°ëŠ” ì•„ë‹˜
---
### 1ï¸âƒ£2ï¸âƒ£ AudioWorklet ë™ì‘ ì›ë¦¬ ë° 128í”„ë ˆì„ ì²˜ë¦¬ ì£¼ê¸° í•™ìŠµ  

AudioWorkletProcessorëŠ” ì•½ 128 ìƒ˜í”Œ ë‹¨ìœ„ / 8ms ê°„ê²©ìœ¼ë¡œ process() í˜¸ì¶œë¨ (sampleRate: 16000 ê¸°ì¤€)  
ë‚´ë¶€ì—ì„œ Float32 â†’ Int16 ë³€í™˜ í›„, port.postMessage()ë¥¼ í†µí•´ FastAPIë¡œ ì „ë‹¬  
WebSocket ì „ì†¡ ì‹œ ìë™ìœ¼ë¡œ ArrayBuffer â†’ ë°”ì´ë„ˆë¦¬ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì§ë ¬í™”ë¨ â†’ ì„œë²„ì—ì„œëŠ” receive_bytes()ë¡œ ìˆ˜ì‹   
ê° í”„ë ˆì„ì˜ ì—ë„ˆì§€ë¥¼ ê³„ì‚°í•˜ì—¬ VAD í•„í„°ë§ì„ ì ìš©í•¨ (energy < 0.0005 ì‹œ ë¬´ìŒìœ¼ë¡œ íŒë‹¨)  
---
### 1ï¸âƒ£3ï¸âƒ£ PCM vs WAV ì°¨ì´ í•™ìŠµ â†’ Whisper ì…ë ¥ êµ¬ì¡° í•™ìŠµ  

PCMì€ ë””ì§€í„¸ ì˜¤ë””ì˜¤ì˜ ì›ë³¸(raw) ë°ì´í„°ì´ê³ , WAVëŠ” ì—¬ê¸°ì— í—¤ë”ë¥¼ ë¶™ì¸ íŒŒì¼ í¬ë§·  
WhisperëŠ” 16kHz, mono ì±„ë„, int16 PCM í¬ë§·ì„ ìš”êµ¬í•¨  
ë”°ë¼ì„œ scipy.io.wavfile.write()ë¥¼ í†µí•´ .wav íŒŒì¼ë¡œ ì €ì¥ í›„ Whisper ì…ë ¥ì— ì‚¬ìš©  
---
### 1ï¸âƒ£4ï¸âƒ£ Redis Pub/Sub êµ¬ì¡° í•™ìŠµ â†’ ë‹¤ì¤‘ ì±„ë„ êµ¬ë… ë° ì¬ë°œí–‰ ì²˜ë¦¬ í•™ìŠµ  

listener_serviceëŠ” result_channelì„ êµ¬ë…í•˜ì—¬ STT ê²°ê³¼ ìˆ˜ì‹   
ê²°ê³¼ ë©”ì‹œì§€ëŠ” result_messages, í†µê³„ ë©”ì‹œì§€ëŠ” final_stats ì±„ë„ë¡œ ê°ê° ì¬ë°œí–‰  
FastAPIëŠ” ë‘ ì±„ë„ì„ asyncio.create_task()ë¡œ êµ¬ë…í•˜ì—¬, WebSocketì„ í†µí•´ ë¸Œë¼ìš°ì €ì— ì‹¤ì‹œê°„ ì „ì†¡ 
---
### 1ï¸âƒ£5ï¸âƒ£ ï¸ì˜¤ë””ì˜¤ ì…ë ¥ í¬ë§· ì´í•´ ë° Float32 â†’ Int16 ë³€í™˜ ì´ìœ  í•™ìŠµ  

ğŸ¤ ë§ˆì´í¬ ì…ë ¥ ê¸°ë³¸ í¬ë§· ë¹„êµ  

| í”Œë«í¼ | ì˜¤ë””ì˜¤ ìº¡ì²˜ ë°©ì‹ | ê¸°ë³¸ í¬ë§· | ë¹„ê³  |
|--------|------------------|------------|------|
| **ë¸Œë¼ìš°ì € (Chrome, Firefox ë“±)** | `getUserMedia()` + Web Audio API | `Float32` (32bit ì‹¤ìˆ˜í˜•) | Web Audio APIëŠ” í•­ìƒ Float32ë¡œ ë™ì‘ |
| **ëª¨ë°”ì¼ (Android, iOS)** | OSë³„ ì˜¤ë””ì˜¤ SDK | `Int16` PCM | í•˜ë“œì›¨ì–´ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ ëŒ€ë¶€ë¶„ 16bit PCM |
| **ë°ìŠ¤í¬íƒ‘ (Windows, Linux ë“±)** | WASAPI, ALSA, PortAudio ë“± | `Int16` ë˜ëŠ” `Float32` | ì„¤ì • ê°€ëŠ¥, ê¸°ë³¸ì€ Int16ì¸ ê²½ìš° ë§ìŒ |

> ì¦‰, **ë¸Œë¼ìš°ì € ê¸°ë°˜ ì…ë ¥ì€ í•­ìƒ `Float32`**, Whisper ë“± STT ëª¨ë¸ì€ **`Int16 PCM`**ì„ ìš”êµ¬  

ğŸ” Float32 vs Int16 ë¹„êµ

| í•­ëª© | `Float32` | `Int16` |
|------|-----------|---------|
| **ë°ì´í„° í˜•ì‹** | ë¶€ë™ì†Œìˆ˜ì  ì‹¤ìˆ˜í˜• | ì •ìˆ˜í˜• |
| **ë¹„íŠ¸ ìˆ˜ / ìš©ëŸ‰** | 32ë¹„íŠ¸ (4ë°”ì´íŠ¸) | 16ë¹„íŠ¸ (2ë°”ì´íŠ¸) |
| **ê°’ì˜ ë²”ìœ„** | -1.0 ~ +1.0 | -32,768 ~ +32,767 |
| **ì •ë°€ë„** | ì†Œìˆ˜ì  í‘œí˜„ ê°€ëŠ¥ | ì •ìˆ˜ë§Œ í‘œí˜„ |
| **Web Audio API ê¸°ë³¸ í¬ë§·** | âœ… ê¸°ë³¸ ì¶œë ¥ | âŒ ì§ì ‘ ì§€ì› ì•ˆ í•¨ |
| **STT ëª¨ë¸ ì…ë ¥ ì§€ì› (Whisper ë“±)** | âŒ ì§€ì› ì•ˆ í•¨ | âœ… ê¸°ë³¸ ìš”êµ¬ í¬ë§· |
| **ì „ì†¡ íš¨ìœ¨** | ë‚®ìŒ (ìš©ëŸ‰ í¼) | ë†’ìŒ (ì ˆë°˜ í¬ê¸°) |

â“ ì™œ Float32 â†’ Int16 ë³€í™˜ì´ í•„ìš”í•œê°€?
- Whisper, DeepSpeech ë“± ëŒ€ë¶€ë¶„ì˜ STT ëª¨ë¸ì€ **Int16 PCM ì…ë ¥ë§Œ ì§€ì›**
- ë¸Œë¼ìš°ì €ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `Float32`ë¡œ ë§ˆì´í¬ ì…ë ¥ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ,
- **ëª¨ë¸ í˜¸í™˜ì„±ê³¼ ì „ì†¡ íš¨ìœ¨**ì„ ìœ„í•´ ë°˜ë“œì‹œ **Float32 â†’ Int16 ë³€í™˜**ì´ í•„ìš”  

### âœ… ê²°ë¡ 
> ë³€í™˜ì€ ë¸Œë¼ìš°ì € ë‚´ AudioWorkletì—ì„œ ìˆ˜í–‰í•˜ê±°ë‚˜, ì„œë²„ì—ì„œ í›„ì²˜ë¦¬ ê°€ëŠ¥  
> í•˜ì§€ë§Œ **í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë¯¸ë¦¬ Int16ìœ¼ë¡œ ë³€í™˜í•˜ë©´** ì„œë²„ ë¶€í•˜ì™€ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆìŒ
---
### 1ï¸âƒ£6ï¸âƒ£ Redis + Celery êµ¬ì¡° ë° Task Queue ê°œë… ì •ë¦¬
### â“  RedisëŠ” ì–´ë–¤ ì—­í• ?  
RedisëŠ” **ì¸ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ Key-Value ì €ì¥ì†Œ**ì´ì, 
RedisëŠ” Celeryì—ì„œ **ë©”ì‹œì§€ ë¸Œë¡œì»¤(Broker)** ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.  
ì¦‰, FastAPI â†’ Celery Task ìš”ì²­ ì‹œ, ì‘ì—… ë‚´ìš©ì´ **Redis Queueë¡œ ì „ë‹¬ë˜ê³ **,  
**WorkerëŠ” í•´ë‹¹ Queueë¥¼ ëª¨ë‹ˆí„°ë§í•˜ë©´ì„œ ì‘ì—…ì„ êº¼ë‚´ ì‹¤í–‰**í•©ë‹ˆë‹¤.

âœ… Redisì˜ ì¸ë©”ëª¨ë¦¬ íŠ¹ì§•

| í•­ëª©             | ì„¤ëª… |
|------------------|------|
| ğŸ”„ **ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„** | ë””ìŠ¤í¬ I/O ì—†ì´ ë©”ëª¨ë¦¬ì—ì„œ ì§ì ‘ ì½ê³  ì“°ë¯€ë¡œ **ì§€ì—°ì‹œê°„ì´ ë§¤ìš° ë‚®ìŒ (sub-millisecond)** |
| ğŸ“¦ **ë°ì´í„° íœ˜ë°œì„±** | ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë˜ë¯€ë¡œ **ì„œë²„ ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì†Œì‹¤ ê°€ëŠ¥**<br>(ì˜µì…˜ìœ¼ë¡œ RDB or AOF ì§€ì†ì„± ì„¤ì • ê°€ëŠ¥) |
| ğŸ’¬ **ë¸Œë¡œì»¤/ìºì‹œ/ì„¸ì…˜** | ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì™¸ì—ë„ **ìºì‹œ, ì„¸ì…˜ ì €ì¥ì†Œ, Pub/Sub ë“± ë‹¤ìš©ë„** í™œìš© ê°€ëŠ¥ |

ğŸ”„ Redis ë©”ì‹œì§€ ì²˜ë¦¬ ë°©ì‹ ë¹„êµ: Queue vs Pub/Sub

| í•­ëª© | Redis List (Queue ë°©ì‹) | Redis Pub/Sub (ì±„ë„ ë°œí–‰/êµ¬ë… ë°©ì‹) |
|------|--------------------------|-------------------------------------|
| êµ¬ì¡° | ì‘ì—…ì„ íì— ìŒ“ê³  êº¼ë‚´ëŠ” êµ¬ì¡° (`lpush` / `blpop`) | ì‹¤ì‹œê°„ ì•Œë¦¼ ì „ì†¡ êµ¬ì¡° (`publish` / `subscribe`) |
| ëª©ì  | ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ / ì•ˆì •ì„± ì¤‘ì‹¬ | ì‹¤ì‹œê°„ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì¤‘ì‹¬ |
| ìƒì‚°ì | `lpush("queue", data)` | `publish("channel", data)` |
| ì†Œë¹„ì | `blpop("queue")` â€“ íì—ì„œ êº¼ë‚´ ì‘ì—… ì‹¤í–‰ | `subscribe("channel")` â€“ ì‹¤ì‹œê°„ ìˆ˜ì‹  |
| ë©”ì‹œì§€ ì†ì‹¤ | âŒ ì†Œë¹„ìê°€ ì—†ì–´ë„ ë©”ì‹œì§€ ë³´ì¡´ë¨ | âš ï¸ êµ¬ë…ì ì—†ìœ¼ë©´ ë©”ì‹œì§€ ìœ ì‹¤ë¨ |
| ìˆœì„œ ë³´ì¥ | âœ… FIFO ë³´ì¥ | âŒ ë³´ì¥ ì•ˆë¨ |
| ì‹¤ë¬´ ì‚¬ìš© | ë¹„ë™ê¸° ì‘ì—… í, ì²˜ë¦¬ ì§€ì—° í—ˆìš© ê°€ëŠ¥ | ì•Œë¦¼, ì±„íŒ…, í†µê³„ ì•Œë¦¼ ë“± ì‹¤ì‹œê°„ ìš”êµ¬ì— ì í•© |
| WhisperTextAnalyzer ë‚´ ì‚¬ìš© | STT/ê°ì • ë¶„ì„ ìš”ì²­ í (stt_queue / analyzer_queue) | STT ê²°ê³¼ ë° í†µê³„ ì „ì†¡ (result_channel ë“±) |

> âœ… ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ”:
> - **ì‘ì—… ë¶„ì‚° ë° ì•ˆì •ì„± í•„ìš” ì‘ì—…**ì€ `Celery + Redis Queue` ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬
> - **ë¸Œë¼ìš°ì € ì‹¤ì‹œê°„ ì•Œë¦¼**ì€ `Redis Pub/Sub` ë°©ì‹ìœ¼ë¡œ ì „ë‹¬

### â“ CeleryëŠ” ì–´ë–¤ ì—­í• ?
CeleryëŠ” Python ê¸°ë°˜ì˜ **ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ í”„ë ˆì„ì›Œí¬**ì…ë‹ˆë‹¤.  
ì§€ì •í•œ Taskë¥¼ **Workerê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰**í•˜ë„ë¡ ë¶„ë¦¬í•  ìˆ˜ ìˆì–´,  
API ì„œë²„ì™€ ë¬´ê±°ìš´ ì‘ì—…ì„ **ë¹„ë™ê¸°/ë¹„ì°¨ë‹¨ ë°©ì‹ìœ¼ë¡œ ë¶„ë¦¬**í•˜ëŠ” ë° íš¨ê³¼ì ì…ë‹ˆë‹¤.

âœ… Celery Task ë¶„ë¦¬ë¡œ ì–»ëŠ” ì´ì 

| í•­ëª©                   | íš¨ê³¼                                                                 |
|----------------------|----------------------------------------------------------------------|
| APIì™€ ë¬´ê±°ìš´ ì²˜ë¦¬ ë¶„ë¦¬   | FastAPIëŠ” ì‘ë‹µë§Œ ì²˜ë¦¬í•˜ê³ , STT/ê°ì • ë¶„ì„ì€ Workerê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬                        |
| ì¥ì•  ê²©ë¦¬              | í•˜ë‚˜ì˜ Worker ì˜¤ë¥˜ ë°œìƒ ì‹œ â†’ ì „ì²´ ì„œë²„ ì˜í–¥ ì—†ì´ ê°œë³„ ì¥ì• ë§Œ ë°œìƒ (ì„œë¹„ìŠ¤ ì•ˆì •ì„± í–¥ìƒ)          |
| í™•ì¥ì„±                 | ì‘ì—… ì¢…ë¥˜(stt / analyzer ë“±)ë³„ë¡œ Workerë¥¼ ë‚˜ëˆ„ê±°ë‚˜, Workerë¥¼ ë‹¤ì¤‘ ì‹¤í–‰í•˜ì—¬ ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥     |
| ì¬ì‹œë„ / íƒ€ì„ì•„ì›ƒ ì„¤ì •    | Celery Taskì— retry, acks_late, time_limit ì˜µì…˜ ë“±ì„ ì¶”ê°€í•´ ì‘ì—… ì‹¤íŒ¨ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘ ê°€ëŠ¥     |
ğŸ› ï¸ ê¸°ë³¸ Celery Task í˜¸ì¶œ íë¦„  

```
FastAPI (Celery send_task) â¬… queue="stt_queue" ë“± ì§€ì •
â†“ 
Redis (Broker / Queue)
â†“
stt_worker (Celery Workerê°€ Queue ëª¨ë‹ˆí„°ë§ â†’ ì‘ì—… ì‹¤í–‰)
```
1. Celery ë“±ë¡ ì˜ˆì‹œ

```python
@celery.task(name="stt_worker.transcribe_audio", queue="stt_queue")
def transcribe_audio(audio_bytes):
    ...
```
2. Celery Task ì‚¬ìš© ì˜ˆì‹œ
```python
celery.send_task(
    "stt_worker.transcribe_audio",  # ë“±ë¡ëœ Task ì´ë¦„
    args=[audio_bytes],             # ë„˜ê²¨ì¤„ ì¸ì (ìŒì„± ë°”ì´ë„ˆë¦¬)
    queue="stt_queue"               # ì²˜ë¦¬í•  Celery Queue ì§€ì •
)
# args: ì‘ì—…ì— ë„˜ê¸¸ ì¸ì
# queue: ì‘ì—…ì´ ë“¤ì–´ê°ˆ Redis í ì´ë¦„ (ì»¨í…Œì´ë„ˆë„ ë™ì¼ íë¥¼ ëª…ì‹œí•´ì•¼í•¨)
```
3. docker-compose ì„ ì–¸ ì˜ˆì‹œ
```
services:
  stt_worker:
    build: ./stt_worker
    command: celery -A stt_worker:celery worker -Q stt_queue --loglevel=info --concurrency=1 --pool=solo
    environment:
      - REDIS_HOST=redis
# -Q stt_queue ë¡œ í•´ë‹¹ Workerê°€ ì²˜ë¦¬í•  íë¥¼ ëª…ì‹œ
# --concurrency=1, --pool=solo â†’ ìœˆë„ìš° í™˜ê²½ì—ì„œ ì•ˆì • ì‹¤í–‰ í•„ìˆ˜ ì˜µì…˜
```
â“ ì™œ í ì´ë¦„ì„ ëª…ì‹œí•´ì•¼ í•˜ë‚˜ìš”?  
>Celery ê¸°ë³¸ Queue ì´ë¦„ì€ celery ì—¬ëŸ¬ Worker/ì„œë¹„ìŠ¤ê°€ ì¡´ì¬í•  ê²½ìš°,  
ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ ì¶©ëŒ ê°€ëŠ¥, í˜¹ì€ default Redis queueì— ë“¤ì–´ê°  
ë”°ë¼ì„œ ë°˜ë“œì‹œ -Q íì´ë¦„ ë° queue="íì´ë¦„" ì„ ì„œë²„ì™€ ì›Œì»¤ ì–‘ìª½ì— ëª…í™•íˆ ì§€ì •í•´ì•¼ ì•ˆì •ì„± í™•ë³´

---

## ğŸš€ ì‹¤ ì„œë¹„ìŠ¤ ë°°í¬ ê²½í—˜

WhisperTextAnalyzer í”„ë¡œì íŠ¸ëŠ” ê°œë°œ â†’ í…ŒìŠ¤íŠ¸ â†’ ì‹¤ë°°í¬ê¹Œì§€ ëª¨ë“  ê³¼ì •ì„ ì§ì ‘ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.

### ğŸ› ï¸ ë°°í¬ ê³¼ì •
- Azure Linux VM ì‹¤ì„œë²„ êµ¬ì¶•
- ê°œë°œ ë‹¨ê³„ì—ì„œ ngrokë¡œ HTTPS ê°œë°œ í…ŒìŠ¤íŠ¸
- ë¬´ë£Œ ë„ë©”ì¸ ì„œë¹„ìŠ¤ [DuckDNS](https://www.duckdns.org) ì‚¬ìš©
- Let's Encryptë¡œ SSL ì¸ì¦ì„œ ë°œê¸‰ ë° ì ìš©
- nginx + Docker + FastAPI ì—°ë™í•˜ì—¬ êµ¬ì„±
- Celery Worker + Redis Broker + WebSocket ì‹¤ì‹œê°„ ì—°ë™

### ğŸŒ ì‹¤ ì„œë¹„ìŠ¤ ì£¼ì†Œ(í˜„ì¬ëŠ” ë§‰í˜!)
[https://whisperproject.duckdns.org/](https://whisperproject.duckdns.org/)
---

## ğŸ’» ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•

ëª¨ë“  ì„œë¹„ìŠ¤ëŠ” Docker Compose ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.  
ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”.

```bash
# 1. ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ
docker-compose build

# 2. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (stt_workerëŠ” 2ê°œë¡œ ìŠ¤ì¼€ì¼ë§)
docker-compose up --scale stt_worker=2 -d
```

```bash
ğŸ’¡ ì°¸ê³ : í˜„ì¬ composeì—ëŠ” ìœˆë„ìš© --concurrency=1 --pool=solo ì˜µì…˜ì´ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ìœˆë„ìš°ì—ì„œ ì‚¬ìš©ì‹œ stt_workerì„ ë³µì‚¬í•´ì„œ stt_worker1ë¡œ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
```
### nginx ì„¤ì • ì˜ˆì‹œ

```nginx
server {
    listen 80;
    server_name whisperproject.duckdns.org;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name whisperproject.duckdns.org;
    ssl_certificate /etc/letsencrypt/live/whisperproject.duckdns.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/whisperproject.duckdns.org/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:8000;
    }

    location /ws {
        proxy_pass http://127.0.0.1:8000/ws;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }
}
```
## ğŸ“ í´ë” êµ¬ì¡°

```
WhisperTextAnalyzer/
â”œâ”€â”€ analyzer_worker/ # ê°ì • ë¶„ì„ Celery Worker (Huggingface Transformers)
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ analyzer_worker.py
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ fastapi_service/ # FastAPI WebSocket Server + í´ë¼ì´ì–¸íŠ¸ UI + Redis Subscriber
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ fastapi_service.py
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ listener_service/ # Redis Pub/Sub Listener â†’ result_channel, final_stats ì²˜ë¦¬
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ listener_service.py
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ recorder_service/ # ğŸ™ï¸ (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©) ë§ˆì´í¬ ì…ë ¥ â†’ Redis push
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ recorder_service.py
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ stt_worker/ # Whisper ê¸°ë°˜ STT Celery Worker
â”‚ â”œâ”€â”€ Dockerfile
â”‚ â”œâ”€â”€ stt_worker.py
â”‚ â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ docker-compose.yml # ë„ì»¤ ì»´í¬ì¦ˆ
â”œâ”€â”€ requirements.txt # Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ì •ì˜ ëª¨ìŒ
â”œâ”€â”€ README.md # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â””â”€â”€ ê¸°íƒ€ íŒŒì¼ # .env, .gitignore ë“± ê¸°íƒ€ ì„¤ì • íŒŒì¼
```
---

## âš ï¸ ì£¼ì˜ì‚¬í•­ ë° ë³´ì•ˆ ê¶Œê³ 
ë³¸ í”„ë¡œì íŠ¸ëŠ” í•™ìŠµ ë° ë°ëª¨ìš©ì´ë©°, ì‹¤ì œ ì„œë¹„ìŠ¤ ë°°í¬ ì‹œ HTTPS ë° ë³´ì•ˆ ì„¤ì •ì„ ë°˜ë“œì‹œ ê°•í™”í•˜ì„¸ìš”.
